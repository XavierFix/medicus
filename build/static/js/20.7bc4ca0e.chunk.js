(this.webpackJsonpmedicus=this.webpackJsonpmedicus||[]).push([[20],{147:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return w}));var a=n(12),c=n.n(a),r=n(11),s=n(52),o=n(13),i=n(9),p=n(0),u=n(3),m=n(31),l=n(51),j=n(32),d=n(50),b=n(23),h=n(1);function f(e){var t=Object(p.useState)(""),n=Object(i.a)(t,2),a=n[0],s=n[1],u=Object(p.useState)({amount:""}),m=Object(i.a)(u,2),l=m[0],f=m[1];function O(){return(O=Object(o.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:f(Object(r.a)(Object(r.a)({},l),{},Object(j.a)({},t.target.name,t.target.value)));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(){return(y=Object(o.a)(c.a.mark((function t(n){var a,o,i;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n.preventDefault(),t.prev=1,!(l.amount>e.appointment.paymentBalance)){t.next=4;break}throw new Error("Payment amount cannot be more than balance.");case 4:return a={fromUsername:Object(b.o)({user:e.session}),toUsername:Object(b.o)({user:e.appointment.physician}),amount:l.amount,date:new Date},t.next=7,fetch("/api/appointments/".concat(e.appointment.id,"/payments"),{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e.session.authToken)},body:JSON.stringify(a)});case 7:return o=t.sent,t.next=10,o.json();case 10:if(i=t.sent,o.ok){t.next=13;break}throw new Error(i.message);case 13:a.id=i.id,e.appendPayment&&e.appendPayment(a),f(Object(r.a)(Object(r.a)({},l),{},{amount:""})),t.next=22;break;case 18:t.prev=18,t.t0=t.catch(1),console.error("Failed to add new payment. ".concat(t.t0)),s(t.t0.message);case 22:case"end":return t.stop()}}),t,null,[[1,18]])})))).apply(this,arguments)}return Object(h.jsxs)(d.a,{className:"container-fluid",handleSubmit:function(e){return y.apply(this,arguments)},children:[a&&Object(h.jsx)(d.f,{className:"justify-content-center",children:Object(h.jsx)("div",{className:"alert alert-danger",role:"alert",children:a})}),Object(h.jsxs)(d.f,{className:"my-2",children:[Object(h.jsx)(d.d,{for:"paymentWidget1",className:"col-sm-4",children:"Amount"}),Object(h.jsx)(d.c,{className:"col-sm-8",children:Object(h.jsx)("input",{id:"paymentWidget1",type:"number",name:"amount",className:"form-control",value:l.amount,onChange:function(e){return O.apply(this,arguments)},placeholder:"Add payment amount",min:"0",step:"0.01"})})]}),Object(h.jsx)(d.f,{className:"my-2 justify-content-center",children:Object(h.jsx)(d.g,{className:"col-auto col-md-4",children:"Pay"})})]})}var O=n(33),y=n(17);function x(e){return Object(h.jsx)(l.l,{children:Object(h.jsx)(y.e,{children:Object(h.jsx)(y.g,{children:Object(h.jsx)(y.a,{className:"md-font-sm text-center text-muted",children:"No payment available"})})})})}function v(e){var t=new Date(e.payment.date);return Object(h.jsx)(l.l,{children:Object(h.jsx)(y.e,{children:Object(h.jsx)(y.g,{children:Object(h.jsx)(y.a,{className:"align-self-center",children:Object(h.jsxs)(y.g,{children:[Object(h.jsx)(y.a,{className:"text-truncate",children:Object(h.jsx)(b.b,{value:e.payment.amount})}),Object(h.jsx)(y.a,{className:"col-auto",children:Object(h.jsx)(O.f,{date:t})})]})})})})})}function g(e){return Object(h.jsx)(l.k,{children:0!==e.payments.length?Object(h.jsx)(h.Fragment,{children:e.payments.map((function(t,n){return Object(h.jsx)(v,{session:e.session,payment:t,handleDelete:e.deletePayment},n)}))}):Object(h.jsx)(x,{})})}function w(e){var t=Object(p.useState)({payments:[],limit:10}),n=Object(i.a)(t,2),a=n[0],j=n[1];function d(){return(d=Object(o.a)(c.a.mark((function t(){var n,o,i,p;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n="/api/appointments/".concat(e.appointment.id,"/payments"),(o=new URLSearchParams).append("page",Math.ceil(a.payments.length/a.limit)),o.append("limit",a.limit),t.next=7,fetch("".concat(n,"?").concat(o.toString()),{headers:{Authorization:"Bearer ".concat(e.session.authToken)}});case 7:return i=t.sent,t.next=10,i.json();case 10:if(p=t.sent,i.ok){t.next=13;break}throw new Error(p.message);case 13:j((function(e){var t=[].concat(Object(s.a)(e.payments),Object(s.a)(p));return Object(r.a)(Object(r.a)({},e),{},{payments:t})})),t.next=19;break;case 16:t.prev=16,t.t0=t.catch(0),console.error("Failed to append more payments. ".concat(t.t0));case 19:case"end":return t.stop()}}),t,null,[[0,16]])})))).apply(this,arguments)}function b(){return(b=Object(o.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:j((function(e){var n=[t].concat(Object(s.a)(e.payments));return Object(r.a)(Object(r.a)({},e),{},{payments:n})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function O(){return(O=Object(o.a)(c.a.mark((function t(n){var s,o;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetch("/api/appointments/".concat(e.appointment.id,"/payments/").concat(n),{method:"DELETE",credentials:"same-origin",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e.session.authToken)}});case 3:return s=t.sent,t.next=6,s.json();case 6:if(o=t.sent,s.ok){t.next=9;break}throw new Error(o.message);case 9:j((function(e){var t=a.payments.filter((function(e){return e.id!==n}));return Object(r.a)(Object(r.a)({},e),{},{payments:t})})),t.next=15;break;case 12:t.prev=12,t.t0=t.catch(0),console.error("Failed to delete payment- ".concat(n,". ").concat(t.t0));case 15:case"end":return t.stop()}}),t,null,[[0,12]])})))).apply(this,arguments)}var y=Object(u.a)(e.session,e.appointment.patient);return Object(h.jsxs)(h.Fragment,{children:[Object(h.jsxs)(l.e,{children:[Object(h.jsx)(l.a,{title:"Payments",children:y&&Object(h.jsx)(l.d,{target:"apptPaymentAdd01",expandIcon:"add",collapseIcon:"clear"})}),Object(h.jsx)(l.g,{id:"apptPaymentAdd01",children:Object(h.jsx)(f,{session:e.session,appointment:e.appointment,appendPayment:function(e){return b.apply(this,arguments)}})}),Object(h.jsx)(g,{session:e.session,payments:a.payments,deletePayment:function(e){return O.apply(this,arguments)}})]}),Object(h.jsx)(m.a,{callback:function(){return d.apply(this,arguments)}})]})}},52:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var a=n(24);var c=n(20);function r(e){return function(e){if(Array.isArray(e))return Object(a.a)(e)}(e)||function(e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||Object(c.a)(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}}}]);
//# sourceMappingURL=20.7bc4ca0e.chunk.js.map